<div class='container-fluid splash-main box-shadow-1'>
  <div class='row'>

    <% unless flash.empty? %>
      <div id='flash-messages-container' class='col-xs-8 col-sm-7'>
        <% flash.each do |message_type, message| %>
          <div class="flash-message">
            <%= message %>
          </div>
        <% end %>
      </div>
    <% end %>
    <div id='title-container' class='col-xs-12 col-md-6'>
        <img src='https://d2m6u6shu0evoe.cloudfront.net/images/gametiks_logo.png' class='title-desktop'/>
        <img src='https://d2m6u6shu0evoe.cloudfront.net/images/gametiks_logo_head.png' class='title-mobile'/>
        <img src='https://d2m6u6shu0evoe.cloudfront.net/images/gametiks_condensed.png' id='gametiks-condensed' class='visible-xs'/>
    </div>
    <div id='slideshow-container-block' class='col-xs-12 col-md-6'>
      <div id='slideshow-container-flex'>

      </div>
    </div>
    <%= render partial: 'staff_pick' %>
    <div id='bottom-row'></div>
  </div>
  <div id='staff-pick-button-container' class='col-xs-5 col-sm-3'>
    <div id='staff-pick-button' class='main-btn gametiks-gradient-cool'>
      STAFF PICK OF THE WEEK
    </div>
    <div id='right-frame'></div>
  </div>
  <div id='splash-buttons-container' class='col-xs-12'>
    <% if !current_user %>
    <div id='group-1' class='col-xs-5 col-sm-4'>
      <div id='left-frame'></div>
      <div id='right-frame'></div>
      <div id='sign-up-buttons-container' class='col-xs-12'>
        <a href='/users/sign_up' class='main-btn gametiks-gradient-cool'>
          SIGN UP WITH EMAIL
          <i class="fa fa-envelope fa-2x" aria-hidden="true"></i>
        </a>
        <a class='main-btn gametiks-gradient-cool' href='/users/auth/facebook' data-confirm="If you have already signed up by email, this will create another account!">
          CONTINUE WITH
          <i class="fa fa-facebook-square fa-2x" aria-hidden="true"></i>
        </a>
      </div>
    </div>
    <% end %>
    <% if current_user %>
      <div id='group-2' class='col-xs-5 col-sm-4'>
        <div id='gallery-button-container'>
          <% if current_user %>
          <div id='left-frame'></div>
          <% end %>
          <a href='/gallery' id='gallery-button' class='main-btn gametiks-gradient-cool'>
            VISIT GALLERY
            <i class='fa fa-camera fa-2x' aria-hidden='true'></i>
          </a>
        </div>
      </div>
    <% else %>
      <div id='group-2' class='col-xs-4 col-sm-4'>
        <div id='gallery-button-container'>
          <% if current_user %>
          <div id='left-frame'></div>
          <% end %>
          <a href='/gallery' id='gallery-button' class='main-btn gametiks-gradient-cool'>
            VISIT GALLERY
            <i class='fa fa-camera fa-2x' aria-hidden='true'></i>
          </a>
        </div>
      </div>
    <% end %>
  </div>
</div>
</div>

<div class='container-fluid'>
  <div class='row'>
    <div class='elevator-pitch-container'>
      <div class='elevator-pitch'>
        <p>BROWSE HARVESTS AROUND THE GLOBE</p>
      </div>
    </div>
  </div>
  <div class='row'>
    <%= render partial: 'maps/main_map' %>
  </div>
</div>

<script>
  $(document).ready(function() {

    if ($('#sign-up-buttons-container').length === 0) {
      $('#title-container').css('padding-top', '30px');
      $('#title-container').animate({
        opacity: 1.0
      }, 500);
    } else {
      $('#title-container').animate({
        opacity: 1.0
      }, 500);
    };

    var interval = null;
    $('#staff-pick-button').click(function() {
        var staffPickVisible = ($('#staff-pick-container').css('display') === 'block')
      if (staffPickVisible) {
        $('#staff-pick-container').hide();
        $('#slideshow-container-flex').empty();
        setTimeout(slideshow, 100);
      } else {
        $('#title-container').fadeOut(10);
        $('#slideshow-container-flex').empty();
        $('#slideshow-container-block').hide();
        clearInterval(interval);
        $('#staff-pick-container').show();
        $('#bottom-row').hide();
      }
    });

    // function cycles through harvests from most recent to least recent,
    // grabbing one image at a time and updating the index
    // slideshow is viewable on homepage
    var slideshow = function() {
      var imageIndex = 0;
      var totalImages = gon.harvestCount;

      $('#back-button').click(function() {

        // clearInterval(interval);
        // imageIndex -= 2;
        // getNextImage();
      });

      $('#resume-button').click(function() {

        // interval = setInterval(getNextImage, 3500);
      });

      var resumeSlideshow = function() {
        $('#slideshow-container-flex').empty();
        $('#slideshow-container-block').show(function() {
          renderLoadingNotification();
          getNextImage();
          interval = setInterval(getNextImage, 3500);
        });
      };

      $('#title-container').fadeOut(100, function() {
        resumeSlideshow();
      });

      var renderLoadingNotification = function() {
        $('#slideshow-container-flex').html('loading recent harvests');
      };

      var getNextImage = function() {
        $.ajax({
          type: 'GET',
          url: '/slideshow',
          dataType: 'script',
          data: {
            harvest: {
              imageIndex: imageIndex
            }
          }
        }).done(function() {
          if (imageIndex + 1 < totalImages) {
            imageIndex ++;
          } else {
            imageIndex = 0;
          };
        });
      };
    }; // end slideshow


    // fires slideshow on page load;
    setTimeout(slideshow, 2200);
  });

</script>
