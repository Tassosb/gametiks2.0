
<div class='container-fluid background-main fixed-height'>
  <div class="row">

    <div class='user-plate-container'>
      <div id='flashbox-container'>
        <div id='flashbox-handle'>
          <% 3.times do %>
            <div id='vertical-line'></div>
          <% end %>
        </div>
        <div id='flashbox-label'>
          NOTES
        </div>
        <div id='flashbox'>
            <i class="fa fa-exclamation-circle fa-2x" aria-hidden="true"></i>
          <% flash.each do |message_type, message| %>
            <div class="alert alert-<%= message_type %>"><%= message %></div>
          <% end %>
        </div>
        <div id='decor-lower-right'></div>
      </div>
      <div id='contacts-container'>
        <div id='contacts-handle'>
          <% 3.times do %>
            <div id='vertical-line'></div>
          <% end %>
        </div>
        <div id='contacts-label'>
          CONTACTS
        </div>
        <i class="fa fa-user-circle fa-2x" aria-hidden="true"></i>
        <div id='contacts'>
          <% contacts = {} %>
            <% current_user.contacts.each do |contact| %>
            <% contacts[contact.id] = contact.name %>
            <% end %>
          <ul>
            <% contacts.each do |id, name| %>
              <li class='contact'>
                <div id="arrow-right">
                  <i id='arrow-right-icon' class="fa fa-arrow-circle-o-right fa-lg" aria-hidden="true"></i>
                </div>
                <a href='/users/<%= id %>'><%= name %></a>
                <div class='backing'></div>
                <div class='second-backing'></div>
              </li>
            <% end %>
          </ul>
            <div id='list-footer'></div>
        </div>
        <div id='decor-lower-left'></div>
      </div>
      <div class='user-plate'>
        <div id='avatar'>
          <div id='corner-pieces-container'>
            <div id='upper-left'></div>
            <div id='upper-right'></div>
            <div id='lower-left'></div>
            <div id='lower-right'></div>
          </div>

          <% if @user == current_user %>
            <button id='rollover-uploader' onclick="document.getElementById('user-avatar').click();">
              <i class="fa fa fa-arrow-circle-o-up fa-5x" aria-hidden="true"></i>
              <h3>REPLACE</h3>
            <!-- hidden form -->
            <form class="edit_user" id="edit_user_<%= current_user.id %>" enctype="multipart/form-data"
              action="/users/<%= current_user.id %>" accept-charset="UTF-8" data-remote="true" method="post">
              <input name="utf8" type="hidden" value="&#x2713;" />
              <input type="hidden" name="_method" value="patch" />
              <input name="authenticity_token" value="<%= form_authenticity_token %>"
                type="hidden">
              <div id="upload-wrap">
                <input id="user-avatar" type="file" name="user[avatar]" />
              </div>
            </form>

            </button>
          <% end %>

          <%= @user.avatar.present? ? image_tag(@user.avatar.url(:square), id: 'avatar-img') : image_tag("https://s3.amazonaws.com/gametiks/users/avatars/Gametiks_Gamercard.jpg") %>
        </div>

        <div id='user-info'>
          <div id='name-container'>
            <h2>
              <%= @user.name.upcase %>
            </h2>
            <div id='square-additive'></div>
          </div>
          <div id='user-sub-info'>
            <h5 id='activated'>Activated: <%= @user.created_at %></h5>
            <% @user.save_points %>
            <h4>User Points: <span class='field'><%= @user.formatted_points %></span></h4>
            <h4>User Rank: <span class='field'><%= rank(@user) %></span></h4>
            <h4>Choice Weapon: <span class='field'><%= favorite_weapon(@user) %></span></h4>
            <h4>Choice Game Type: <span class='field'><%= favorite_animal(@user) %></span></h4>
          </div>
          <% if current_user == @user %>
            <div id='upload-btn-container'>
              <div id='btn-panel'>
                  <%= link_to 'UPLOAD HARVEST', new_harvest_path %>
              </div>
            </div>
          <% end %>

          <% if current_user != @user && !current_user.contacts.include?(@user)%>
            <div id='add-contact-container'>
              <form class="new_user_contact" id="new_user_contact" enctype="multipart/form-data"
                action="/user_contacts" accept-charset="UTF-8" method="post">
                <input name="utf8" type="hidden" value="&#x2713;" />
                <input type='hidden' name='user_contact[contact_id]' value='<%= @user.id %>' />
                <input name="authenticity_token" value="<%= form_authenticity_token %>"
                  type="hidden">
                <input id='add-contact' type='submit' value='ADD TO CONTACTS'/>
              </form>
            </div>
          <% end %>

          <% if current_user.contacts.include?(@user) %>
            <div id='affirm-contact'>
              In Contacts <i class="fa fa-check-circle-o" aria-hidden="true"></i>
            </div>
          <% end %>

        </div>
        <div id='user-level'>
          <img src='https://s3.amazonaws.com/gametiks/images/badges/lev_00.png' id='level-badge'/>
        </div>
      </div>
    </div>
  </div>

  <div class='row'>
    <div id='styled-separator-container-top'>
      <div id='left'></div>
      <div id='center'>
        <nav id='user-records'>
          <ul>
            <li id='map-tab'>
              MAP
              <div class='square'></div>
            </li>
            <li id='tiks-tab'>
              TIKS
            </li>
            <li id='badges-tab'>
              BADGES
              <div class='square'></div>
            </li>
          </ul>
        </nav>
      </div>
      <div id='right'></div>
    </div>
  </div>
  <div id='switchable-window'>
    <div class='row'>
      <%= render partial: "maps/user_map" %>
      <%= render partial: "tiks" %>
      <%= render partial: "badges" %>
    </div>
  </div>

</div>
<%= render partial: "logbook" %>

<script>
  var userId = gon.userId;

  $(document).ready(function() {

    // auto load windows
    $('#map-tab').click(function(){
      $("#user-map-container").css("left", "0");
      $("#tiks-container").css("left", "100%");
      $("#badges-container").css("left", "200%");
    });

    $("#tiks-tab").click(function(){
      $("#user-map-container").css("left", "-100%");
      $("#tiks-container").css("left", "0");
      $("#badges-container").css("left", "100%");
    });

    $("#badges-tab").click(function(){
      $("#user-map-container").css("left", "-200%");
      $("#tiks-container").css("left", "-100%");
      $("#badges-container").css("left", "0");
    })

    var avatarForm = document.getElementById(`edit_user_${userId}`);

    $(avatarForm).change(function(){
      $("#avatar").append("<i class='fa fa-spinner fa-pulse fa-5x fa-fw middle-middle'></i>");
      avatarForm.submit();
    });

    // display messages if any
    var innerHTML = $('#flashbox').html();
    var iconOnly = '<i class="fa fa-exclamation-circle fa-2x" aria-hidden="true"></i>';
    if ( innerHTML.trim() !== iconOnly ) {
      $( "#flashbox-container" ).animate({
        left: '+=192px'
      }, 100);
      setTimeout(retract, 2000);
    };

    function retract(){
      $( "#flashbox-container" ).animate({
        left: '-=192px'
      }, 100);
    };

    // toggle message box
    $('#flashbox-handle').click(function() {
      $('#flashbox-container').toggleClass('flashbox-active');
    });

    $('#flashbox-label').click(function() {
      $('#flashbox-container').toggleClass('flashbox-active');
    });

    $('#contacts-handle').click(function() {
      $('#contacts-container').toggleClass('contacts-active');
    });

    $('#contacts-label').click(function() {
      $('#contacts-container').toggleClass('contacts-active');
    })

    $('.contact').hover(function() {
      $( this ).css('padding-left', '16px');
      $( this ).children(":first").css('opacity', 1);
    }, function() {
      $( this ).css('padding-left', '10px');
      $( this ).children(":first").css('opacity', 0);
    });
  });

</script>


          <!-- <h4>

          </h4>
      </section>
      <section>
        <div class="badges"><h3>BADGES</h3>
            <% @user.clear_all_badges %>
          <ul><% @user.load_badges %>
              <% @user.badges.each do |badge| %>
              <li><%= image_tag badge.image %></li>
              <% end %>
          </ul>
        </div>
      </section>
    </aside>
    <br>

  </div> -->
